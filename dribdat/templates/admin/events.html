{% extends "admin/layout.html" %}

{% block content %}
<div class="container admin-events">
  <div class="btn-group float-right mb-2">
    <a href="{{ url_for('public.event_new') }}" class="btn btn-success btn-lg">Start an event</a>
    <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#importEvent">
      Import</button>
  </div>
    <h2>Events</h2>
    <table class='table table-hover'>
        <thead>
            <tr>
              <th></th>
              <th width="100%">Name</th>
              <th>Start</th>
              <th>Finish</th>
              <th>Manage</th>
            </tr>
        </thead>
        {% for event in events %}
        <tr>
            <td>
              <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="evMenu{{ event.id }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Action ...
                </button>
                <div class="dropdown-menu" aria-labelledby="evMenu{{ event.id }}">
                  <a href="{{ url_for('admin.event', event_id=event.id) }}" class="dropdown-item">
                    &#9734; Edit
                  </a>
                  <a href="{{ url_for('admin.event_projects', event_id=event.id) }}" class="dropdown-item">
                    &#9734; Projects
                  </a>
                  <a href="{{ url_for('public.event_print', event_id=event.id) }}" class="dropdown-item">
                    &#9734; Print
                  </a>
                  <!-- <a href="{{ url_for('public.event_instruction', event_id=event.id) }}" class="dropdown-item">
                    Instructions
                  </a> -->
                  <a href="{{ url_for('public.event', event_id=event.id, _external=True) }}?embed=1" class="dropdown-item" id="embed-link">
                    Embed
                  </a>
                  <a href="{{ url_for('public.dashboard', event_id=event.id) }}" class="dropdown-item">
                    Dashboard
                  </a>
                  <!-- <a href="{{ url_for('api.info_event_hackathon_json', event_id=event.id) }}" class="dropdown-item">
                    &#9734; hackathon<b>.json</b>
                  </a> -->
                  <a href="{{ url_for('api.project_list_event_csv', event_id=event.id) }}" class="dropdown-item">
                    &#9660; projects<b>.csv</b>
                  </a>
                  <a href="{{ url_for('api.event_participants_csv', event_id=event.id) }}" class="dropdown-item">
                    &#9660; participants<b>.csv</b>
                  </a>
                  <a href="{{ url_for('api.package_specific_event', event_id=event.id, format='json') }}" class="dropdown-item">
                    &#9660; datapackage<b>.json</b>
                  </a>
                  <a href="{{ url_for('api.package_specific_event', event_id=event.id, format='zip') }}" class="dropdown-item">
                    &#9660; datapackage<b>.zip</b>
                  </a>
                </div>
              </div>
            </td>
            <td>
              <a href="{{ url_for('admin.event', event_id=event.id) }}" style="float:right">
              {% if event.is_current %}
                <span class="btn btn-warning btn-sm">Current</span>
              {% endif %}
              {% if event.lock_editing %}
                <span title="Editing locked" class="btn btn-dark btn-sm">Freeze</span>
              {% endif %}
              {% if event.lock_starting %}
                <span title="Creating locked" class="btn btn-dark btn-sm">Lock</span>
              {% endif %}
              {% if event.lock_resources %}
                <span title="Projects are considered global resources" class="btn btn-dark btn-sm">Resource</span>
              {% endif %}
              {% if event.is_hidden %}
                <span class="btn btn-dark btn-sm">Hidden</span>
              {% endif %}
              </a>

              <a class="event-name" href="{{ url_for('public.event', event_id=event.id) }}">
                {{ event.name }}
              </a>
            </td>
            <td>{{ event.starts_at|format_date }}</td>
            <td>{{ event.ends_at|format_date }}</td>
            <td class="btn-group">
              <a href="{{ url_for('admin.event', event_id=event.id) }}" class="btn btn-primary">
                Edit
              </a>
              <a href="{{ url_for('admin.event_projects', event_id=event.id) }}" class="btn btn-info">
                {{ event.project_count }}&nbsp;projects
              </a>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- Upload Event dialog -->
<div class="modal fade uploader" id="importEvent" tabindex="-1" role="dialog" aria-labelledby="uploadFileLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadFileLabel">Upload Event</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="upload-note">
          Currently only <b><a href="https://frictionlessdata.io/field-guide/" target="_blank">Data Packages</a></b> are accepted.
          These can be exported using recent versions of dribdat:
          click the drop-down button next to an event listing in the admin.
          Max {{ (config.MAX_CONTENT_LENGTH/(1024*1024))|round(1) }} MB.
          You can enter the URL of a remote instance to get around this limit.
        </p>
        <div class="input-group" style="margin-top:1em">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputFileLabel">Select</span>
          </div>
          <div class="custom-file">
            <input type="file" class="custom-file-input" id="inputFile"
              name="image" aria-describedby="inputFileLabel" accept="application/json"
              data-maxsize="{{ config.MAX_CONTENT_LENGTH }}">
            <label class="custom-file-label" for="inputImageFile">Choose file</label>
          </div>
        </div>
        <div class="input-group" style="margin-top:1em">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputUrlLabel">URL</span>
          </div>
          <div class="custom-file">
            <input type="text" class="input-group-text" style="width:50em;background:white" id="inputUrl"
              name="image" aria-describedby="inputUrlLabel">
          </div>
        </div>
        <center class="col" style="margin-top:1em" id="file-confirm">
          <div class="btn-group">
            <button class="btn btn-primary" data-target="xclip">
              Validate and preview
            </button>
            <button class="btn btn-warning" data-target="weblink">
              Import only basic event data
            </button>
            <button class="btn btn-info" data-target="pitch">
              Include event, projects, users
            </button>
          </div>
        </center>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div><!-- / Upload Event -->
{% endblock %}
